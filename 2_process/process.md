## 进程、地址空间与线程

`地址空间(address space)`，一个进程可以使用的全部内存地址和它们存储的数据。可以认为是一个或多个线程与一个地址空间的结合。

两方面
> 1. 进程的结构必须囊括一个进程的运行状态，用于中断、异常或系统调度进入内核态时，我们应该能够将进程的运行状态放入内存中的某一位置，使我们可以在某一个时间点根据进程的优先级接着这次的进度再次运行改进程。
> 2. 进程在用户一侧对内存进行了抽象，需要在系统一侧包含从抽象内存向实际内存和外存的映射，以便通过抽象内存地址获得物理地址和其中存储的数据。


现代计算机往往有多个核或多个处理器，程序因此可以达到`并行(parallelism)`，物理时间上同时运行。区别于多个进程在处理器上的`并发(concurrency)`。为了更好的区分进程在一个处理器上的运行状态和进程本身的运行状态，引入`线程(thread)`。每个线程拥有一个`线程控制块(thread control block-TCB)`，用来存储处理器状态寄存器、指针计数器、栈指针、通用寄存器等数值，但同一个进程的所有线程都共享一个地址空间。

内存空间是抽象的，与物理内存对应。那么中间有个映射关系。地址转换有很多方法，分页存储和分段存储。Base and Bound。后面会讲。

会用一个数据结构来封装它，叫`进程控制块(Process Control Block-PCB)`，进程控制块中存储的信息除了上面提到的实现地址转换的信息和表示运行状态的线程信息外，还包括很多系统在调度进程时需要的信息，比如：进程号、进程所处状态、进程优先级等。

进程控制块中的信息包含了优先级、基地址、可用地址范围等用户进程不应该有权修改的信息，用户进程不应该有权限修改进程控制块。我们将进程控制块存储在内核空间中。

## 进程状态与用户态和内核态之间的切换

### 三态模型。
进程三个状态。`运行态(running)、就绪态(ready)和等待态(wait)`

等待态就是进程等待某一事件完成，等待获得某一个锁或收到某一信号量的信号等等。

### 五态模型
`新建态(new)、终止态(exit)`

`新建态`对应着进程被创建时尚未加入就绪队列的状态。为了建立一个新的进程，内核需要给进程分配资源，这个过程就处于新建态。

`终止态`对应着进程已经结束但尚未被系统撤销的状态。进程已经结束，但资源还未被系统回收。

感觉UNIX就是这样设计的。五态模型。


![五态图形](五态图形.jpg)